# 인바디 상담 결과지 (Herbalife Coach InBody Report)

## 프로젝트 개요
- **프로젝트명**: 인바디 상담 결과지 웹앱 (전문 상담 시스템)
- **목표**: 초보 웰니스 코치들도 전문가 수준으로 인바디 상담을 할 수 있도록 상세하고 실질적인 가이드 제공
- **주요 특징**:
  - 10년 경력 프리미어 코치 수준의 전문 분석
  - 허벌라이프 제품별 구체적 섭취 방법 (시간, 용량, 혼합법)
  - 체성분 지표 간 상호 연관성 분석
  - 실전 상담 스크립트 (오프닝 → 이슈 설명 → 솔루션 → 클로징)
  - 개인 맞춤 4주 실천 가이드 
  - 인바디 이미지 업로드 (드래그&드롭 + 파일 선택)
  - AI 비전 모델을 통한 인바디 수치 자동 인식 및 분석
  - 허벌라이프 제품 중심의 맞춤 솔루션 제공
  - 상담용 멘트 및 SMS 결과지 자동 생성
  - 탭/섹션으로 구분된 결과 표시
  - 각 섹션별 복사 기능

## 📍 URL
- **개발 서버**: https://3000-isso04whx9nn6o9avgi93-d0b9e1e2.sandbox.novita.ai
- **API 엔드포인트**: `/api/analyze` (POST)

## 🎯 완성된 기능

### 1. 전문가 수준 AI 분석 엔진
- ✅ GPT-4o Vision 모델 (이미지 인식)
- ✅ 10년 경력 프리미어 코치 페르소나
- ✅ 체성분 지표 간 상호 연관성 분석
- ✅ 표준 범위 기준 정확한 평가
- ✅ 8000 토큰 (기존 4000 → 2배 확장)

### 2. 허벌라이프 제품 전문 지식 (2025년 10월 기준)
- ✅ **실제 제품 카탈로그** 반영
  - Formula 1 건강한 식사 (63,000원) - 7가지 맛
  - Formula 2 멀티비타민 (33,300원)
  - Formula 3 단백질 파우더 (65,600원)
  - 허벌 베버리지 (77,300원)
  - 엔-알-지 티 (34,700원)
  - 프로틴 바 디럭스 (58,200원)
  - 기타 25개 이상 전체 라인업
- ✅ **정확한 가격 정보** (권장소비자가격)
- ✅ **번들팩 및 프로그램** 포함
  - 쿠키앤크림 번들팩 (66,000원)
  - 건강한 아침식사 프로그램 (161,900원)
  - 체중조절 프로그램 (441,400원)
- ✅ **Herbalife24 스포츠 라인** 포함
- ✅ **각 제품별 상세 섭취법**
  - 정확한 용량 (예: 2스푼 26g)
  - 혼합 비율 (물 250ml + 우유 200ml)
  - 섭취 시간 (일어나서 30분 이내, 식전 30분 등)

### 3. 실전 상담 스크립트 (고객 언어)
- ✅ **제품 설명 실전 멘트**
  - "우주식", "두부 1모", "밥 2스푼 칼로리" 비유 활용
  - "짝꿍", "반찬", "쏙쏙" 친근한 표현
  - 구체적 수치로 신뢰도 상승 (90칼로리, 9g 단백질)
- ✅ **5단계 구조화된 멘트**
  1. 오프닝: 공감 + 긍정 + 생활습관 인정
  2. 핵심 이슈: 수치 → 일상 증상 연결
  3. 연관성: 여러 지표 간 관계 (교육)
  4. 솔루션: 구체적 실천법 + 제품 + 이유
  5. 클로징: 동기부여 + 기대 효과 + 기간 명시
- ✅ **초보 코치도 자신감 있게 상담 가능**

### 4. 프로그램별 맞춤 접근 (7가지)
- ✅ **다이어트 프로그램**: 체지방 과다형
  - Formula 1 저녁 대체 + 셀-유-로쓰 + 허벌 베버리지
- ✅ **피로개선 프로그램**: 에너지 부족형
  - Formula 1+2+3 조합 + 리프트오프/엔-알-지 티
- ✅ **장건강 프로그램**: 소화 불편형
  - Formula 1 + 셀-유-로쓰 + 액티브 화이버 + 프로바이오틱
- ✅ **여성건강 프로그램**: 호르몬 균형형
  - Formula 1+2 + 릴렉세이션 티 + 프롤레사 듀오
- ✅ **면역건강 프로그램**: 면역력 저하형
  - Formula 1+2 + 마이뮨 플러스 + 홍삼 진센 겔
- ✅ **혈행건강 프로그램**: 순환 개선형
  - Formula 1+2 + 나이트웍스 + 허벌 알로에
- ✅ **헬씨에이징 프로그램**: 40대 이상
  - Formula 1+2+3 + 나이트웍스 + 프로바이오틱

### 4. 개인 맞춤 옵션
- ✅ **목표 설정**:
  - 체지방 우선: 저녁 쉐이크 대체 + 식이섬유 강조
  - 근육 우선: 단백질 보강 + Formula 3 추가
  - 균형: 기본 루틴 중심
- ✅ **말투 스타일**:
  - 부드럽게: "~네요", "~거예요" (격려형, 우주식 비유)
  - 전문가스럽게: "~입니다" (과학적 근거 강조)
  - 매우 간단히: 짧은 문장, 핵심만

### 4. 결과 표시 (6개 탭) - 전문가 수준 상세 분석
- ✅ **요약**: 핵심 포인트 + 개선 방향 (구체적 수치 포함)
- ✅ **핵심 지표**: 7개 지표 + 상태 평가 + 표준 범위 비교
- ✅ **해석**: 3개 카드 (각 3-4문장 이상)
  - 근육량과 기초대사 상태 (골격근량, 기초대사량, 체력 연결)
  - 체지방 분포와 대사 건강 (체지방률, 내장지방, 복부지방률)
  - 체성분 밸런스와 개선 방향 (우선순위, 현실적 목표)
- ✅ **솔루션**: 
  - 일일 루틴 (아침/점심/저녁): 각 2-3개 제품
    * 제품명 + 필요 이유 (인바디 수치 기반) + 구체적 섭취법
    * 시간, 용량, 물 양, 혼합 방법까지 디테일하게 제공
  - 체지방 관리 포인트 (2-3개): 수치 + 실천법 + 제품
  - 근육/대사 관리 포인트 (2-3개): 수치 + 실천법 + 제품
- ✅ **상담 멘트**: 5-7문장 (실전 상담 구조)
  - 오프닝 (공감 + 긍정) → 핵심 이슈 → 연관성 설명 → 솔루션 → 동기부여
- ✅ **SMS**: 250-300자 (이모지 포함, 핵심만 압축)

### 5. 복사 기능
- ✅ 각 섹션별 복사 버튼
- ✅ 복사 성공 시 토스트 알림

## 🚧 아직 구현되지 않은 기능
- ⏳ 데이터 저장 기능 (현재는 브라우저 내에서만 처리, 새로고침 시 초기화)
- ⏳ 이전 분석 결과 조회
- ⏳ PDF 다운로드 기능
- ⏳ 4주 가이드 탭 (데이터는 받지만 UI 미구현)
- ⏳ Cloudflare Pages 프로덕션 배포

## 📊 데이터 아키텍처

### AI 모델
- **사용 모델**: GPT-5 (GenSpark LLM Proxy)
- **입력**: 인바디 결과지 이미지 + 시스템 프롬프트 + 사용자 옵션(목표/말투)
- **출력**: JSON 형식의 구조화된 분석 결과

### 데이터 흐름
1. 사용자가 인바디 이미지 업로드
2. 프론트엔드에서 이미지를 base64로 변환
3. `/api/analyze` 엔드포인트로 POST 요청
4. 백엔드에서 OpenAI Vision API 호출 (이미지 분석)
5. AI가 JSON 형식으로 분석 결과 반환
6. 프론트엔드에서 결과를 파싱하여 6개 탭으로 렌더링

### 데이터 모델
```typescript
{
  one_line_summary: string,
  metrics: Array<{
    name: string,
    value: string,
    status: "정상" | "주의" | "개선 필요"
  }>,
  interpretation: Array<{
    title: string,
    detail: string
  }>,
  herbalife_solution: {
    daily_routine: Array<{
      timing: string,
      items: Array<{
        product: string,
        why: string,
        how: string
      }>
    }>,
    fat_management: Array<{
      point: string,
      action: string,
      product_suggestion: string
    }>,
    muscle_metabolism: Array<{
      point: string,
      action: string,
      product_suggestion: string
    }>,
    compliance_note: string
  },
  coach_script: string[],
  guide_4weeks: Array<{
    week: string,
    focus: string,
    checkpoints: string[]
  }>,
  sms_result: string
}
```

### 저장소
- **현재**: 저장 없음 (브라우저 메모리)
- **향후 계획**: Cloudflare D1 Database 또는 KV Storage

## 💻 기술 스택
- **프레임워크**: Hono (v4.11.3) - Cloudflare Workers 최적화
- **런타임**: Cloudflare Workers
- **프론트엔드**: 
  - TailwindCSS (CDN)
  - Font Awesome 6.4.0 (아이콘)
  - Vanilla JavaScript
- **AI**: OpenAI Vision API (GPT-5)
- **빌드 도구**: Vite (v6.3.5)
- **배포**: Wrangler (Cloudflare Pages)

## 🚀 사용 방법

### 1. 환경 설정
**중요**: AI 분석 기능을 사용하려면 GenSpark LLM API 키가 필요합니다.

1. GenSpark 프로젝트의 **API Keys** 탭으로 이동
2. API 키 생성
3. **Inject** 버튼을 클릭하여 샌드박스 환경에 주입

또는 `.dev.vars` 파일을 생성하여 로컬 개발 시 사용:
```bash
OPENAI_API_KEY=your_api_key_here
OPENAI_BASE_URL=https://www.genspark.ai/api/llm_proxy/v1
```

### 2. 로컬 개발 서버 시작
```bash
# 포트 정리
npm run clean-port

# 빌드
npm run build

# PM2로 서버 시작
pm2 start ecosystem.config.cjs

# 서버 상태 확인
pm2 list

# 로그 확인
pm2 logs webapp --nostream

# 서버 재시작
npm run clean-port && pm2 restart webapp

# 서버 중지
pm2 delete webapp
```

### 3. 웹앱 사용
1. 브라우저에서 개발 서버 URL 접속
2. 인바디 결과지 이미지 업로드 (드래그&드롭 또는 파일 선택)
3. 목표 및 말투 선택 (선택사항)
4. "분석하기" 버튼 클릭
5. AI 분석 완료 후 6개 탭에서 결과 확인
6. 필요한 섹션의 "복사" 버튼으로 클립보드에 복사

## 📋 권장 다음 단계

### 우선순위 높음
1. ✅ **실제 인바디 이미지로 테스트** - 다양한 케이스로 AI 응답 품질 확인
2. **프롬프트 미세 조정** - 실제 상담 사례 피드백 반영
3. **4주 가이드 탭 UI 구현** - 현재 데이터는 생성되지만 표시 안 됨

### 우선순위 중간
4. **Cloudflare Pages 배포** - 프로덕션 환경에 배포
5. **PDF 다운로드** - 결과를 PDF로 저장 (고객 공유용)
6. **분석 이력 저장** - Cloudflare D1으로 과거 기록 관리

### 우선순위 낮음
7. **사용자 인증** - 코치별 계정 관리
8. **통계 대시보드** - 코치별/기간별 상담 통계
9. **WhatsApp/카카오톡 공유** - 원클릭 메시지 전송

## 🔒 컴플라이언스 및 보안
- ✅ 치료/완치/질병명/병원/의사/처방 등 의학적 표현 금지
- ✅ 코칭 목적 명시 (치료/진단 아님)
- ✅ 허벌라이프 국내 정식 제품만 제안
- ✅ 건강한 식습관 및 영양 보충 관점으로만 설명
- ⚠️ 개인정보(이름/성별/나이) 마스킹 없음 (현재는 저장하지 않으므로 문제 없음)

## 📁 프로젝트 구조
```
webapp/
├── src/
│   ├── index.tsx          # 메인 Hono 애플리케이션 (백엔드 + 프론트 렌더링)
│   └── renderer.tsx       # JSX 렌더러 (HTML 헤드 설정)
├── public/
│   └── static/
│       ├── app.js         # 프론트엔드 JavaScript (UI 로직)
│       └── style.css      # 커스텀 CSS
├── dist/                  # 빌드 결과물
├── ecosystem.config.cjs   # PM2 설정
├── wrangler.jsonc         # Cloudflare 설정
├── package.json           # 의존성 및 스크립트
├── tsconfig.json          # TypeScript 설정
├── vite.config.ts         # Vite 빌드 설정
└── README.md              # 프로젝트 문서
```

## 🎨 AI 분석 품질 특징

### 전문성
- **10년 경력 페르소나**: 수천 명 상담 경험 반영
- **체성분 분석 전문가**: 지표 간 상호 연관성 깊이 있게 분석
- **영양학 컨설턴트**: 허벌라이프 제품 전문 지식

### 디테일
- **해석 섹션**: 각 3-4문장 이상, 구체적 수치 기반
- **제품 제안**: 단순 나열이 아닌 "왜 필요한지 + 어떻게 먹는지" 상세 설명
- **실천 가능성**: 시간, 용량, 혼합법까지 구체적으로 제시

### 맞춤화
- **목표별**: 체지방/근육/균형에 따라 솔루션 우선순위 조정
- **말투별**: 고객 성향에 맞춘 커뮤니케이션 스타일
- **수치 기반**: 일반론이 아닌 개인 인바디 수치 기반 분석

## 🐛 알려진 이슈
- ⚠️ AI 응답이 JSON 형식이 아닐 경우 fallback 처리 필요
- ⚠️ 매우 큰 이미지 업로드 시 성능 저하 가능
- ⚠️ 인터넷 연결 없이는 AI 분석 불가 (CDN 의존성)

## 📝 라이선스
허벌라이프 코칭 전용 내부 도구

## 📧 문의
프로젝트 관련 문의는 GenSpark 프로젝트 페이지를 통해 연락주세요.

---

**마지막 업데이트**: 2025-12-28  
**상태**: ✅ 개발 완료 (프로덕션 배포 대기)  
**버전**: 1.0.0
